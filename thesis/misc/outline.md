# 自動生成されるURLに適したハッシュ関数に関する検討

## 1.はじめに
ユーザ投稿型のシステムや何らかの理由で一時ファイルを作成する必要がある場合など、他と重複しないようなファイル名を生成する機会は多い。この際、ユーザ投稿型システムのように、最終的に生成した名前が URL の一部として利用される場合、できればこの URL は短い方が望ましい。

そこで、実運用としては衝突が発生しない範囲でできるだけ自動生成される URL やファイル名を短くする手法を検討する。これを実現するには、ハッシュ生成関数としてどれを利用するのが良いのか、生成されたハッシュ値の何桁分を利用すれば（運用上）大丈夫そうなのかと言った事の検討がある。また、下記のような方法もあるので、そう言った方法の組み合わせを検討する。


## 2.手法説明

### 2.1 ハッシュ関数について
ハッシュ関数は入力したデータに対してランダム性のある値を返す関数である。得られた値はハッシュ値と呼ばれ、元のデータの特徴を表す短い符号として利用することができ、データの比較や検索を高速化することができる。用途や特性に応じた計算手法が存在し、データの改竄や破損の検知、類似データの探索などに応用される.
### 2.2 ハッシュ関数の種類
今回調査したハッシュ関数は４種類で、１つ目がMD5、２つ目がSHA-1、3つ目がAHA-256、4つ目がsha-512である。

MD5は入力したデータを元に128bitの値を生成するハッシュ関数であり、同じ入力データの場合必ず同じ値が得ることが可能だが１文字でも入力が異なっている場合は、全く別の値になる。

SHA-1は入力データから160bitの値を出力するハッシュ関数であり、SHA-1もMD５と同様入力データが１文字でも異なると、全く異なるハッシュ値が出力される。
米国家安全保障局が考案し、1995年に登場。
しかし、SHA-1もセキュリティの面で不安定な強度になってしまったため、2017年以降はどのブラウザにも対応されなくなる。

SHA-256は前述のSHA-2のバリエーションであり、そのアップデートバージョンであるSHA-2のバリエーションの一つになる。
ハッシュ値を256bitで生成されるようになったことで、32bitパソコンに最適化される様になった。また、ファイルが改竄されているかの有無も確認することが可能である。

sha-512はsha-256と同じSHA-2のバリエーションの一つであり、ハッシュ値を512bitで生成させることによって64bitパソコンに最適化された。同じくsha-384も64bitパソコンに最適化されているが、二つの処理速度は同等である。

### 2.3 base64について
Base64は主に電子メールで使われ、指定された64文字で表すエンコード方式である。
Base64の64は64進数を意味し、バイナリデータというコンピューターが理解するデータを一定の規則に基づいてテキストデータに置き換える変換も担っている。


## ３.実行結果

### 3.1 各ハッシュ関数の実行方法と結果

どのハッシュ関数も”HELLO"と”HELLE"という単語を用いて、ハッシュ値の違いについて調べた。

#### MD5 

”HELLO": eb61eead90e3b899c6bcbe27ac581

"HELLE": cd44092e51f1c170469f6a4f36dc2f80

#### SHA-1

”HELLO":  c65f99f8c5376adadddc46d5cbcf5762f9e55eb7

"HELLE": e7861652cb1453f142ae36c0bef1f95b79b8a3fb

#### SHA-256

”HELLO": 3733cd977ff8eb18b987357e22ced99f46097f31ecb239e878ae63760e83e4d5

"HELLE": 5b175fdd8cdfd78c967643ad01f951210364c65642dbf5410f3fb778160585db

#### sha-512

”HELLO": 33DF2DCC31D35E7BC2568BEBF5D73A1E43A0E624B651BA5EF3157BBFB728446674A231B8B6E97FA1E570C3B1DE6D6C677541B262AC22AFDA5878FA2B591C7F08

"HELLE": 1F5C11FA78C5DD2407BBFB26621C73126CEA0135E8056CF2D6609187125A8B34406EDB3E036C3A6B0568F097E522CFB58A737D7124B5BCE0F904E3AEE429B6EB

### 3.2 base64の実行と結果

こちらでは「こんにちは」と「こんにちわ」で実行の比較を行った。

「こんにちは」:44GT44KT44Gr44Gh44Gv

「こんにちわ」:44GT44KT44Gr44Gh44KP

### 3.3 二つの違い

ハッシュ関数では全てのバリエーションにおいて、単語が一文字変化するだけで全く異なる文字列が生成され,
全く同じ文字列を生成される確率は低い。しかしエンコード方式では単語がひとつ違った場合、文字の桁数は前述したハッシュ関数より短く生成されるが、下二桁の文字列が変化するだけでありURLの衝突が起こる可能性が高い。


## 4 提案手法

上記で解説したハッシュ関数を用いてURLの文字列を一定にする。
しかし、上記５つのハッシュ関数で文字列を一定にしたURLの自動生成は可能ではあるが、

MD5 32文字　sha-1 40文字　sha256 64文字　sha-512 128文字

といったようにsha-2のバリエーションが生成される文字列はセキュリティ面の高さやURLが衝突する可能性は限りなく低くなるが、このままでは短縮対象とするURLと長さが変わらないため、MD5とsha-1のどちらかを用いた方法で検討を行った。



##  5.まとめと今後の課題
ハッシュ関数は入力データを規則性のない値、ハッシュ値を返す関数になっており、1文字でも入力データが異なると、全く別のハッシュ値に変化する。
そしてbase64はデータを指定された64文字で表すエンコード方式であり、一文字入力データが異なっても大した変化はなかったという結果だった。
